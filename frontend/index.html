<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>FON - Fluxo Operacional de Neg√≥cios</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f5f5f5; color: #333; }
        :root { --primary-color: #1a3a52; --primary-dark: #0f2537; --primary-light: #2c5573; --accent-color: #3498db; }
        .toast-container { position: fixed; top: 20px; right: 20px; z-index: 10000; }
        .toast { background: #fff; padding: 15px 20px; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.2); margin-bottom: 10px; display: flex; align-items: center; gap: 10px; min-width: 280px; animation: slideInRight 0.3s ease; font-size: 14px; }
        .toast.success { border-left: 4px solid #4caf50; }
        .toast.error { border-left: 4px solid #f44336; }
        @keyframes slideInRight { from { transform: translateX(400px); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
        #loginPage { width: 100%; min-height: 100vh; display: flex; justify-content: center; align-items: center; background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%); padding: 20px; }
        .loginBox { background: #fff; padding: 40px 35px; border-radius: 12px; box-shadow: 0 15px 50px rgba(0,0,0,0.3); width: 100%; max-width: 420px; }
        .loginBox h1 { color: var(--primary-color); text-align: center; margin-bottom: 5px; font-size: 32px; font-weight: 800; }
        #appPage { display: none; width: 100%; min-height: 100vh; flex-direction: row; }
        .sidebar { width: 260px; background: var(--primary-color); color: #fff; overflow-y: auto; }
        .menu-item { padding: 16px 22px; cursor: pointer; transition: all 0.25s; border-left: 4px solid transparent; display: flex; align-items: center; gap: 10px; font-size: 14px; }
        .menu-item.active { background: var(--accent-color); border-left-color: #fff; }
        .main-content { flex: 1; display: flex; flex-direction: column; background: #ecf0f1; overflow: hidden; }
        .header { background: #fff; padding: 16px 26px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); display: flex; justify-content: space-between; align-items: center; }
        .content { flex: 1; padding: 24px; overflow-y: auto; }
        .card { background: #fff; padding: 20px; border-radius: 10px; box-shadow: 0 3px 15px rgba(0,0,0,0.1); border-top: 4px solid var(--primary-color); margin-bottom: 20px; }
        .dashboard-cards { display: grid; grid-template-columns: repeat(auto-fit, minmax(230px, 1fr)); gap: 20px; margin-bottom: 25px; }
        table { width: 100%; border-collapse: collapse; background: #fff; border-radius: 10px; overflow: hidden; }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid #eee; }
        th { background: #f8f9fa; font-size: 12px; text-transform: uppercase; color: #666; }
        .form-row { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 15px; }
        input, select { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; }
        .btn { padding: 10px 20px; border: none; border-radius: 6px; cursor: pointer; font-weight: 700; transition: 0.3s; }
        .btn-primary { background: var(--primary-color); color: #fff; }
        .secao { display: none; }
    </style>
</head>
<body>
    <div id="toast-container" class="toast-container"></div>
    <div id="loginPage">
        <div class="loginBox">
            <h1>‚ñ∂ FON</h1>
            <p style="text-align:center; margin-bottom:20px;">Fluxo Operacional de Neg√≥cios</p>
            <div style="margin-bottom:15px;"><label>Email</label><input type="email" id="loginEmail" value="admin@fon.com.br"></div>
            <div style="margin-bottom:20px;"><label>Senha</label><input type="password" id="loginPass" value="admin123"></div>
            <button class="btn btn-primary" style="width:100%" onclick="handleLogin()">Entrar</button>
        </div>
    </div>
    <div id="appPage">
        <div class="sidebar">
            <div style="padding:20px; background: var(--primary-dark); text-align:center;"><h2>FON</h2><p style="font-size:10px; opacity:0.7;">Operacional de Neg√≥cios</p></div>
            <div class="menu-item active" onclick="showSecao('dashboard')">üìä Dashboard</div>
            <div class="menu-item" onclick="showSecao('nova-inter')">‚ûï Nova Intermedia√ß√£o</div>
            <div class="menu-item" onclick="showSecao('lista-inter')">üìã Intermedia√ß√µes</div>
            <div class="menu-item" onclick="showSecao('financeiro')">üí∞ Financeiro</div>
            <div class="menu-item" onclick="showSecao('config')">‚öôÔ∏è Configura√ß√£o</div>
        </div>
        <div class="main-content">
            <div class="header"><h1 id="page-title">Dashboard</h1><div><span id="userName">Usu√°rio</span> <button class="btn" onclick="handleLogout()">Sair</button></div></div>
            <div class="content">
                <div id="sec-dashboard" class="secao" style="display:block;">
                    <div class="dashboard-cards">
                        <div class="card"><h3>Total Vendas</h3><div class="value" id="dash-total-vendas">R$ 0,00</div></div>
                        <div class="card"><h3>Escrituradas</h3><div class="value" id="dash-total-escr">R$ 0,00</div></div>
                        <div class="card"><h3>Reserva/Pr√©</h3><div class="value" id="dash-total-res">R$ 0,00</div></div>
                    </div>
                </div>
                <div id="sec-nova-inter" class="secao">
                    <div class="card">
                        <h2>Nova Intermedia√ß√£o</h2>
                        <form id="formInter">
                            <div class="form-row">
                                <div><label>Data</label><input type="date" id="f-data" required></div>
                                <div><label>PV</label><input type="text" id="f-pv" required></div>
                                <div><label>Ref</label><input type="text" id="f-ref"></div>
                            </div>
                            <div class="form-row">
                                <div><label>Empreendimento</label><input type="text" id="f-emp" required></div>
                                <div><label>Unidade</label><input type="text" id="f-un" required></div>
                            </div>
                            <div class="form-row">
                                <div><label>Valor Total (R$)</label><input type="number" step="0.01" id="f-valor" required></div>
                                <div><label>Taxa (%)</label><input type="number" step="0.01" id="f-taxa-p" required></div>
                            </div>
                            <div class="form-row" style="background:#f9f9f9; padding:10px; border-radius:8px;">
                                <div><label>R$ Imob. Principal</label><input type="number" step="0.01" id="f-r-principal"></div>
                                <div><label>R$ Fon (Pessoa)</label><input type="number" step="0.01" id="f-r-fon"></div>
                                <div><label>R$ Canella</label><input type="number" step="0.01" id="f-r-canella"></div>
                                <div><label>R$ Central e Part.</label><input type="number" step="0.01" id="f-r-central"></div>
                            </div>
                            <div class="form-row">
                                <div><label>Status</label><select id="f-status"><option value="Escriturado">Escriturado</option><option value="Reserva">Reserva</option><option value="Pr√© Escriturado">Pr√© Escriturado</option><option value="Cancelado">Cancelado</option></select></div>
                                <div><label>Corretor</label><input type="text" id="f-corretor"></div>
                            </div>
                            <button type="submit" class="btn btn-primary">Salvar Intermedia√ß√£o</button>
                        </form>
                    </div>
                </div>
                <div id="sec-lista-inter" class="secao">
                    <div class="card"><table id="tableInter"><thead><tr><th>Data</th><th>PV</th><th>Emp.</th><th>Valor</th><th>Status</th><th>A√ß√µes</th></tr></thead><tbody></tbody></table></div>
                </div>
                <div id="sec-financeiro" class="secao">
                    <div class="dashboard-cards">
                        <div class="card"><h3>Total Imob. Principal</h3><div class="value" id="fin-total-principal">R$ 0,00</div></div>
                        <div class="card"><h3>Total Fon (Pessoa)</h3><div class="value" id="fin-total-fon">R$ 0,00</div></div>
                        <div class="card"><h3>Total Canella</h3><div class="value" id="fin-total-canella">R$ 0,00</div></div>
                        <div class="card"><h3>Total Central</h3><div class="value" id="fin-total-central">R$ 0,00</div></div>
                    </div>
                </div>
                <div id="sec-config" class="secao">
                    <div class="card">
                        <h2>Configura√ß√£o</h2>
                        <div style="margin-top:15px;"><label>URL do Backend (API)</label><input type="text" id="config-api-url" placeholder="https://seu-backend.onrender.com"><button class="btn btn-primary" style="margin-top:10px;" onclick="saveConfig()">Salvar Configura√ß√£o</button></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
        let currentUser = null; let apiUrl = localStorage.getItem('fon_api_url') || ''; let data = { intermediacoes: [], despesas: [] };
        function showToast(msg, type='success') { const container = document.getElementById('toast-container'); const t = document.createElement('div'); t.className = 'toast ' + type; t.textContent = msg; container.appendChild(t); setTimeout(() => t.remove(), 3000); }
        function formatBRL(v) { return new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(v || 0); }
        async function apiFetch(endpoint, options = {}) {
            if (!apiUrl && endpoint !== 'login') { showToast('Configure a URL da API', 'error'); return null; }
            const base = apiUrl || ''; const url = base.endsWith('/') ? base + 'api/' + endpoint : base + '/api/' + endpoint;
            const token = localStorage.getItem('fon_token'); const headers = { 'Content-Type': 'application/json', ...options.headers };
            if (token) headers['Authorization'] = 'Bearer ' + token;
            try { const res = await fetch(url, { ...options, headers }); if (res.status === 401 || res.status === 403) { if(token) handleLogout(); return null; } return await res.json(); }
            catch (e) { showToast('Erro na API', 'error'); return null; }
        }
        async function handleLogin() {
            const email = document.getElementById('loginEmail').value; const password = document.getElementById('loginPass').value;
            const res = await apiFetch('login', { method: 'POST', body: JSON.stringify({ email, password }) });
            if (res && res.token) { localStorage.setItem('fon_token', res.token); currentUser = res.user; document.getElementById('userName').textContent = currentUser.name; document.getElementById('loginPage').style.display = 'none'; document.getElementById('appPage').style.display = 'flex'; loadData(); }
            else showToast('Falha no login', 'error');
        }
        function handleLogout() { localStorage.removeItem('fon_token'); location.reload(); }
        async function loadData() { const res = await apiFetch('data'); if (res) { data = res; renderAll(); } }
        async function saveData() { await apiFetch('save', { method: 'POST', body: JSON.stringify(data) }); showToast('Dados salvos'); }
        function showSecao(s) { document.querySelectorAll('.secao').forEach(el => el.style.display = 'none'); document.querySelectorAll('.menu-item').forEach(el => el.classList.remove('active')); document.getElementById('sec-' + s).style.display = 'block'; document.getElementById('page-title').textContent = s.toUpperCase(); }
        function renderAll() { renderDashboard(); renderLista(); renderFinanceiro(); }
        function renderDashboard() {
            let total = 0, escr = 0, res = 0; data.intermediacoes.forEach(i => { const v = parseFloat(i.valor) || 0; total += v; if (i.status === 'Escriturado') escr += v; else if (i.status === 'Reserva' || i.status === 'Pr√© Escriturado') res += v; });
            document.getElementById('dash-total-vendas').textContent = formatBRL(total); document.getElementById('dash-total-escr').textContent = formatBRL(escr); document.getElementById('dash-total-res').textContent = formatBRL(res);
        }
        function renderLista() {
            const tbody = document.querySelector('#tableInter tbody'); tbody.innerHTML = '';
            data.intermediacoes.forEach((i, idx) => { const tr = document.createElement('tr'); tr.innerHTML = `<td>${i.data}</td><td>${i.pv}</td><td>${i.emp}</td><td>${formatBRL(i.valor)}</td><td>${i.status}</td><td><button onclick="deleteInter(${idx})">Excluir</button></td>`; tbody.appendChild(tr); });
        }
        function renderFinanceiro() {
            let pri = 0, fon = 0, can = 0, cen = 0; data.intermediacoes.forEach(i => { pri += parseFloat(i.rPrincipal) || 0; fon += parseFloat(i.rFon) || 0; can += parseFloat(i.rCanella) || 0; cen += parseFloat(i.rCentral) || 0; });
            document.getElementById('fin-total-principal').textContent = formatBRL(pri); document.getElementById('fin-total-fon').textContent = formatBRL(fon); document.getElementById('fin-total-canella').textContent = formatBRL(can); document.getElementById('fin-total-central').textContent = formatBRL(cen);
        }
        document.getElementById('formInter').onsubmit = async (e) => {
            e.preventDefault(); const newItem = {
                data: document.getElementById('f-data').value, pv: document.getElementById('f-pv').value, ref: document.getElementById('f-ref').value, emp: document.getElementById('f-emp').value, un: document.getElementById('f-un').value, valor: document.getElementById('f-valor').value, taxaP: document.getElementById('f-taxa-p').value,
                rPrincipal: document.getElementById('f-r-principal').value, rFon: document.getElementById('f-r-fon').value, rCanella: document.getElementById('f-r-canella').value, rCentral: document.getElementById('f-r-central').value, status: document.getElementById('f-status').value, corretor: document.getElementById('f-corretor').value
            };
            data.intermediacoes.push(newItem); await saveData(); renderAll(); e.target.reset();
        };
        function deleteInter(idx) { if (confirm('Excluir?')) { data.intermediacoes.splice(idx, 1); saveData(); renderAll(); } }
        function saveConfig() { const url = document.getElementById('config-api-url').value; localStorage.setItem('fon_api_url', url); apiUrl = url; showToast('Configura√ß√£o salva'); }
        document.getElementById('config-api-url').value = apiUrl;
        if (localStorage.getItem('fon_token')) { document.getElementById('loginPage').style.display = 'none'; document.getElementById('appPage').style.display = 'flex'; loadData(); }
    </script>
</body>
</html>
